From 48a625b4a43930e98b07134c39899ea9d84e8a44 Mon Sep 17 00:00:00 2001
From: Emilien Devos <4016501+unixfox@users.noreply.github.com>
Date: Fri, 21 Jun 2024 23:17:22 +0200
Subject: [PATCH 1/1] retreive potoken for bypass restrictions

---
 src/invidious/yt_backend/youtube_api.cr | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/src/invidious/yt_backend/youtube_api.cr b/src/invidious/yt_backend/youtube_api.cr
index 727ce9a3..b1c2c288 100644
--- a/src/invidious/yt_backend/youtube_api.cr
+++ b/src/invidious/yt_backend/youtube_api.cr
@@ -306,6 +306,12 @@ module YoutubeAPI
       } of String => String | Int64,
     }
 
+    visitor_data = REDIS_DB.get("VISITORDATA")
+
+    if visitor_data
+      client_context["client"]["visitorData"] = visitor_data
+    end
+
     # Add some more context if it exists in the client definitions
     if !client_config.screen.empty?
       client_context["client"]["clientScreen"] = client_config.screen
@@ -488,6 +494,9 @@ module YoutubeAPI
           "html5Preference": "HTML5_PREF_WANTS",
         },
       },
+      "serviceIntegrityDimensions" => {
+        "poToken": REDIS_DB.get("POTOKEN"),
+      },
     }
 
     # Append the additional parameters if those were provided
-- 
2.45.2

