From e6aa46551f363efef637e39550d85e54e612e12f Mon Sep 17 00:00:00 2001
From: Emilien Devos <4016501+unixfox@users.noreply.github.com>
Date: Fri, 21 Jun 2024 23:17:22 +0200
Subject: [PATCH 1/1] retreive potoken for bypass restrictions

---
 src/invidious/yt_backend/youtube_api.cr | 11 +++++++++++
 1 file changed, 11 insertions(+)

diff --git a/src/invidious/yt_backend/youtube_api.cr b/src/invidious/yt_backend/youtube_api.cr
index 727ce9a3..3eea424b 100644
--- a/src/invidious/yt_backend/youtube_api.cr
+++ b/src/invidious/yt_backend/youtube_api.cr
@@ -306,6 +306,12 @@ module YoutubeAPI
       } of String => String | Int64,
     }
 
+    visitor_data = REDIS_DB.get("VISITORDATA")
+
+    if visitor_data
+      client_context["client"]["visitorData"] = visitor_data
+    end
+
     # Add some more context if it exists in the client definitions
     if !client_config.screen.empty?
       client_context["client"]["clientScreen"] = client_config.screen
@@ -490,6 +496,11 @@ module YoutubeAPI
       },
     }
 
+    po_token = REDIS_DB.get("POTOKEN")
+    if po_token
+      data["serviceIntegrityDimensions"]["poToken"] = po_token
+    end
+
     # Append the additional parameters if those were provided
     if params != ""
       data["params"] = params
-- 
2.45.2

