From 9ec3a9a3b7bb34ee68050a571692c4cc1c6f2fda Mon Sep 17 00:00:00 2001
From: Samantaz Fox <coding@samantaz.fr>
Date: Mon, 22 Aug 2022 08:20:16 +0200
Subject: [PATCH] player.js: Fix PREFS cookie's expires/SameSite/Secure
 parameters

---
 assets/js/player.js | 8 +++++---
 1 file changed, 5 insertions(+), 3 deletions(-)

diff --git a/assets/js/player.js b/assets/js/player.js
index b75e71344..ee678663a 100644
--- a/assets/js/player.js
+++ b/assets/js/player.js
@@ -259,7 +259,7 @@ function updateCookie(newVolume, newSpeed) {
 
     // Set expiration in 2 year
     var date = new Date();
-    date.setTime(date.getTime() + 63115200);
+    date.setFullYear(date.getFullYear() + 2);
 
     var ipRegex = /^((\d+\.){3}\d+|[A-Fa-f0-9]*:[A-Fa-f0-9:]*:[A-Fa-f0-9:]+)$/;
     var domainUsed = location.hostname;
@@ -268,8 +268,10 @@ function updateCookie(newVolume, newSpeed) {
     if (domainUsed.charAt(0) !== '.' && !ipRegex.test(domainUsed) && domainUsed !== 'localhost')
         domainUsed = '.' + location.hostname;
 
-    document.cookie = 'PREFS=' + cookieData + '; SameSite=Strict; path=/; domain=' +
-        domainUsed + '; expires=' + date.toGMTString() + ';';
+    var secure = location.protocol.startsWith("https") ? " Secure;" : "";
+
+    document.cookie = 'PREFS=' + cookieData + '; SameSite=Lax; path=/; domain=' +
+        domainUsed + '; expires=' + date.toGMTString() + ';' + secure;
 
     video_data.params.volume = volumeValue;
     video_data.params.speed = speedValue;
