From 7b9d26d68891fa4e9e65b1ef197e30938571daae Mon Sep 17 00:00:00 2001
From: Samantaz Fox <coding@samantaz.fr>
Date: Mon, 29 Nov 2021 17:21:26 +0100
Subject: [PATCH] Fix #2670

Fixes "Download widget replaces spaces in filename with +"
https://github.com/iv-org/invidious/issues/2670
---
 src/invidious/routes/video_playback.cr | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/invidious/routes/video_playback.cr b/src/invidious/routes/video_playback.cr
index 5c64f6690..394b15925 100644
--- a/src/invidious/routes/video_playback.cr
+++ b/src/invidious/routes/video_playback.cr
@@ -240,7 +240,7 @@ module Invidious::Routes::VideoPlayback
       download_widget = JSON.parse(env.params.query["download_widget"])
 
       id = download_widget["id"].as_s
-      title = download_widget["title"].as_s
+      title = URI.decode_www_form(download_widget["title"].as_s)
 
       if label = download_widget["label"]?
         return env.redirect "/api/v1/captions/#{id}?label=#{label}&title=#{title}"
